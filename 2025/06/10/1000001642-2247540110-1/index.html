<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="仅1.24ms！目标检测与分类Transformer细粒度分析，FPN终结者！（附论文及源码）, ZejunCao&#39;Blogs">
    <meta name="description" content="仅1.24ms！目标检测与分类Transformer细粒度分析，FPN终结者！（附论文及源码）

仅用于站内搜索，没有排版格式，具体信息请跳转上方微信公众号内链接

以下文章来源于微信公众号：集智书童作者：小书童链接：https :&amp;#x2">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>仅1.24ms！目标检测与分类Transformer细粒度分析，FPN终结者！（附论文及源码） | ZejunCao&#39;Blogs</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ZejunCao&#39;Blogs</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ZejunCao&#39;Blogs</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/frontcover/1000001642_2247540110_1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">仅1.24ms！目标检测与分类Transformer细粒度分析，FPN终结者！（附论文及源码）</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%B1%9F%E5%A4%A7%E7%99%BD/">
                                <span class="chip bg-color">江大白</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-06-10
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/Ra-Eq1FIuKhqdJlYuGz8Ww">仅1.24ms！目标检测与分类Transformer细粒度分析，FPN终结者！（附论文及源码）</a></p>
<blockquote>
<p>仅用于站内搜索，没有排版格式，具体信息请跳转上方微信公众号内链接</p>
</blockquote>
<p>以下文章来源于微信公众号：集智书童<br>作者：小书童<br>链接：https :&#x2F;&#x2F;mp. weixin.qq. com&#x2F;s&#x2F;gX3m2CgWrszJnSHp9UJbTw<br>本文仅用于学术分享，如有侵权，请联系后台作删文处理<br>导读<br>针对现有注意力特征融合方法存在高计算复杂度与硬件非友好性瓶颈，本文提出金字塔SparseTransformer（PST）创新方案。该模块通过两阶段注意力机制实现突破：粗粒度阶段强化局部特征，结合参数共享实现训练-推理解耦，推理时灵活激活细分支实现零成本精度跃升，为资源受限场景提供高性价比融合范式。<br>论文链接：https :&#x2F;&#x2F;arxiv. org&#x2F;abs&#x2F;2505. 12772<br>代码链接：https :&#x2F;&#x2F;github. com&#x2F;inlmouse&#x2F;PyramidSparseTransformer<br>1. 当前基于注意力机制的特征融合方法计算复杂度高，实现困难，限制了其在资源受限环境中的应用。<br>2. 现有的轻量化注意力机制（如Sparse或低秩近似）虽然降低了理论成本，但往往破坏了硬件友好的数据流。<br>3. 在检测和分类任务中，如何以极小的计算开销提升模型性能，同时保持空间细节和上下文完整性。<br>1. 金字塔SparseTransformer（PST）模块：提出了一种轻量级、即插即用的特征融合模块，结合从粗到细的token选择策略和共享注意力参数，显著降低计算复杂度，同时保留空间细节。<br>2. 两阶段注意力机制：<br>•粗粒度注意力：通过高层特征图作为对，关注低层特征图中的重要区域，将计算复杂度从降低到。<br>•细粒度注意力：选择性处理由top-粗略Q-K相似性识别的最信息量大的区域，复杂度为。<br>3. 参数共享与训练-推理灵活性：仅通过粗分支进行训练，推理时可灵活激活细粒度注意力，无需重新训练，提供可适应的精度-效率权衡。<br>4. 高效轻量化设计：整个架构仅相当于一个卷积的参数量，适合实际应用。<br>1. 目标检测任务（COCO数据集）：<br>•在YOLOv11-N&#x2F;S&#x2F;M中分别带来0. 9%、0. 5%和0. 4%的mAP提升，且对延迟影响极小。<br>•ResNet-18+PST-N实现了46. 3%的mAP，超越R-50-AFPN（38. 4%）和R-50-A2-FPN-Lite（39. 8%）。<br>•ResNet-101+PST-S达到50. 9%的mAP，显著优于R-101-AFPN（40. 2%）和R-101-A2FPN（42. 8%）。<br>2. 图像分类任务（ImageNet数据集）：<br>•将ResNet-18&#x2F;50&#x2F;101的top-1准确率分别提升6. 5%、6. 1%和1. 0%。<br>•YOLOv11-cls变体的top-1精度提升约1%。<br>3. 实时性与效率：<br>•YOLOv11-PST-N实现40. 3%的mAP，优于Baseline模型（39. 4%），延迟仅为1. 24ms。<br>•PST增强的YOLOv11-S和YOLOv11-M分别达到47. 4%和52. 1%的mAP，且具有相当或更低的FLOPs。<br>1. Top-k选择的敏感性：较大的top-值会引入额外计算开销而未显著提升性能，需谨慎选择适中的值。<br>2. 堆叠设计的冗余性：增加PSA堆叠阶段会导致延迟显著增加，且未能进一步提升准确性。<br>3. 自门控机制的影响：尽管理论上可以增强特征融合能力，但实验表明禁用该机制可能获得更高的性能。<br>4. 线性注意力的适用性：尝试用线性注意力替代标准多头注意力机制并未带来预期效果，反而降低了性能。<br>特征融合对于高性能视觉模型至关重要，但通常会导致过高的复杂度。然而，当前主流的基于注意力机制的融合方法往往涉及显著的计算复杂度和实现挑战，限制了它们在资源受限环境中的效率。<br>为解决这些问题，作者提出了金字塔SparseTransformer（PST），这是一种轻量级、即插即用的模块，它集成了由粗到细的token选择和共享注意力参数，以减少计算量同时保留空间细节。PST仅使用粗注意力机制即可进行训练，并在推理阶段无缝激活以进一步提升精度，无需重新训练。当将其添加到最先进的实时检测模型（如YOLOv11-N&#x2F;S&#x2F;M）中时，在MSCOCO数据集上，PST带来了0. 9%、0. 5%和0. 4%的mAP提升，且对延迟影响极小。<br>同样地，将PST嵌入ResNet-18&#x2F;50&#x2F;101作为Backbone网络，分别将ImageNettop-1准确率提升了6. 5%、6. 1%和1. 0%。这些结果表明，PST作为一种简单且对硬件友好的增强方法，在检测和分类任务中均表现出良好的效果。作者的代码可在以下链接获取。<br>特征融合，即跨层或跨分支组合特征，是现代视觉架构的基本组成部分。基于Transformer的[ 41]和基于CNN的[ 7]模型均表明，内容自适应注意力机制通过将图像特征处理为动态token序列[13,28,18]，显著优于固定的卷积方案。在大语言模型&#x2F;视觉模型时代，将图像分割为patch或潜在向量，使得自然语言处理技术能够直接应用于视觉任务[31,23,19]，同时也促进了图像编辑[32,17]和多模态理解的精确视觉语言对齐。因此，基于Transformer的主干网络和Head结构现已成为识别、检测和分割领域最先进模型的统治者[41,13,28]。<br>尽管现有的基于注意力机制的融合方案（例如FPN、1FPN、DeformableDETR）具有强大的表征能力，但它们仍然存在高FLOPs、不规则内存访问和工程复杂度等问题。Sparse或低秩近似虽然降低了理论成本，但往往破坏了硬件友好的数据流[5,49]。即便是复杂的库（FlashAttention、SageAttention）也必须融合Kernel并分块I&#x2F;O来恢复性能，但它们仍然在密集的token网格上运行。<br>这促使作者提出一个问题：作者能否设计一个即插即用的Transformer模块，用于视觉特征融合，该模块满足以下要求(i)轻量级但具有最先进的性能，(ii)大幅降低复杂度，(iii)保持空间保真度，以及(iv)训练-推理灵活性？<br>为应对这些挑战，作者提出了金字塔SparseTransformer（PST），这是一种分层融合架构，能够在保持计算效率的同时实现高效的跨尺度特征集成。作者的关键技术贡献包括：<br>•作者提出了一种新的分层注意力机制，通过两阶段过程结合粗粒度的全局上下文和细粒度的局部细节：<br>•<br>1. 一层跨层粗注意力阶段，利用高层特征图作为对，以关注更精细的Query，将计算复杂度从降低到<br>•<br>2. 一种Sparse精细注意力阶段，选择性地处理由top-粗略Q-K相似性识别的最信息量大的区域，其中每个选定区域对应于原始特征图中的块，实现复杂度。<br>•作者开发了一种高效的参数共享方案，该方案仅通过粗分支进行训练，同时在推理过程中允许灵活激活细粒度注意力，从而提供可适应的精度-效率权衡。<br>•作者设计整个架构以极轻量级为目标，其参数量仅相当于一个卷积，使其在实际应用中具有极高的实用性。<br>大量实验表明，PST可作为有效的即插即用组件，无缝替换检测Head中的FPN，或集成到包括ResNet[ 15]和YOLO[14,20]在内的各种Backbone架构中。PST在不同模型规模上始终提升性能，在COCO[ 26]上至少获得0. 4%的mAP提升，并在ImageNet[ 9]上提高top-1准确率，同时引入的计算开销极小。<br>Transformer架构通过建模全局依赖和长距离交互，彻底改变了计算机视觉领域。视觉Transformer（ViT）[12]将图像视为一系列Patch的序列，在图像分类方面表现出色，但其固定的Patch尺寸限制了对于检测和分割任务至关重要的多尺度表示能力。为解决这一问题，SwinTransformer[ 28]和PyramidVisionTransformer（PVT）[46,47]等分层设计采用了多阶段架构和空间缩减机制。此外，T2T-ViT[ 50]和CSWinTransformer[ 10]等创新通过专门化的注意力模式增强了局部上下文建模和多尺度特征聚合能力。<br>与此同时，特征融合架构如FPN[ 25]对于整合不同深度的语义仍然至关重要。例如-FPN[ 16]、AC-FPN[ 1]、G-FPN[ 38]和BiFPN[ 37]等变体通过引入注意力机制或增强连接性来改进原始设计，从而实现跨尺度特征的精细化。这些设计在效率和表示丰富性之间取得了平衡，成为许多检测流程的核心支撑。<br>在YOLO系列中，为了增强多尺度特征融合，已集成了目标注意力模块。YOLOv11[ 20]引入了跨阶段部分与空间注意力（C2PSA）模块，该模块在拼接特征图上应用空间注意力，以强调显著区域（尤其是小或被遮挡的物体），而不会显著增加计算成本。YOLOv12[ 40]利用区域注意力机制将特征图划分为多个区域，以保持较大的有效感受野，同时集成FlashAttention以优化内存访问并维持实时吞吐量。这些进展表明，经过精心设计的注意力可以在最小的速度损失下带来显著的精度提升，突显了对更轻量级、即插即用模块（如作者的PST）的需求。<br>标准自注意力机制的高计算成本促使了高效注意力变体的设计。Sparse注意力模型，如MSVi-Longformer，通过限制注意力模式来降低复杂度。此外，Sparse注意力模块使用Sparse注意力聚合上下文信息，以关注语义丰富的区域。DeformableDETR从Sparse参考点采样以加速密集预测。线性注意力近似[5,35]以及GPU优化的Kernel如FlashAttention进一步提升了高分辨率输入的可扩展性。<br>动态token选择为效率提升提供了另一条途径。TokenLearner和DynamicViT等方法基于学习到的token重要性进行剪枝，从而优化了计算性能的权衡。然而，许多此类策略需要额外的监督信号或复杂的架构变更。与此同时，在从粗到细的层次化注意力机制中，动态token选择策略通常构建在细粒度部分。QuadTreeAttention首先构建四叉树token金字塔，并在每一层基于粗粒度注意力分数选择top-区域以指导细粒度注意力。基于这一思路，CF-ViT采用两阶段推理：首先对少量粗粒度块进行快速预测，然后仅对最信息量大的块进行重新分区和重新注意力计算。<br>相比之下，PST模块采用top-ktoken选择策略，以无训练开销的方式动态识别信息区域。它具有粗粒度和细粒度注意力分支之间的参数共享特性，使得模型仅需激活粗粒度注意力即可进行训练。在推理过程中，可以激活细粒度注意力以实现无缝的精度提升，而无需修改已训练的参数。这种设计提供了一个独特的权衡：训练过程中的简洁性和推理过程中的精度提升。结合其模块化和高效性，PST为现有的基于注意力的特征融合机制提供了一种实用且强大的替代方案。<br>在深度学习领域已得到充分验证的是，High-Level特征表示编码了Low-Level细节的紧凑摘要，反映了卷积网络和基于注意力网络的分层抽象过程[51,2]。基于这一见解，可以利用High-Level激活来识别和选择最显著的Low-Level符号，从而提供有针对性的局部特征增强。为了保持上下文完整性和信息完整性，这些经过优化的局部特征随后通过全局特征进行补充，确保既有细粒度细节又具备整体场景理解能力。<br>基于这一共识，作者提出了金字塔SparseTransformer（PST）。图2展示了PST的架构，其与标准自注意力机制不同，其中源自同一特征图[41,13]，而是采用交叉注意力机制：高层特征作为，用于Query从低层特征图中提取，利用层次化图像语义指导细粒度融合[ 46]。通过允许语义丰富的高层token引导注意力聚焦于低层细节，PST增强了上下文对齐能力和判别力，同时减少了token间的交互。<br>作者进一步采用卷积位置编码（CPE）模块代替传统的可学习或正弦嵌入，该模块借鉴自CvT[ 48]。具体而言，作者在注意力操作后对每个特征图应用一个的深度卷积[6,40]。<br>粗粒度到细粒度特征选择：为了控制计算量，PSA采用粗粒度到细粒度的范式选择特征：粗粒度注意力在降采样特征上计算，然后对每个Query的相似度分数进行平均，并在更精细的图中选择前个键值对token。通过仅关注这个细粒度token，PST将复杂度从降低到。作者在粗粒度和细粒度阶段共享所有注意力参数，因此训练可以省略细粒度分支，推理时可以启用它而无需重新训练。<br>对于不同的模型尺寸（N、S、M），通道维度按照1:2:4的比例进行缩放（上限为2048），头数设置为。除非另有说明，作者设置并仅考虑相似度得分高于的情况。<br>具体而言，忽略批次大小和头数，给定两个相邻的特征图和，作者计算：<br>粗略注意力输出是：<br>粗<br>该方法将token交互从降低到，因为。然后，作者通过对注意力矩阵的每一行进行平均来为每个键推导出全局相似度分数：<br>选择使最大的前-个索引（默认，阈值）。这些索引映射到更细的网格，从而在中产生个细粒度token，从中作者收集<br>然后，精细化的注意力为：<br>参数共享：最后，在两个阶段之间共享参数，作者融合输出：<br>通过结合跨层粗注意力机制与Sparse细粒度注意力机制，PST实现了总体复杂度为，同时保留了其空间归纳偏置和简洁性。<br>即插即用卷积模块。整个架构仅依赖于标准卷积和注意力机制，通过在现代加速器上无缝集成高度优化的计算库，能够实现极致的计算效率。<br>整个PST模块的可学习组件由10个卷积层组成，每个卷积层与BatchNorm配对。参数总数由输入特征通道数、高层特征通道数以及token嵌入维度决定，具体如下：<br>显然，PST是一种轻量级设计，其参数规模与单个卷积近似相当。<br>PST-DET结构如图3a所示，通过将PST模块作为插件集成来改进传统FPN。在该架构中，FPN内的原始卷积层被PST模块替换，这些模块处理来自金字塔层P3、P4和P5的拼接特征。这些模块通过上采样和下采样操作适应输入，确保与不同特征分辨率兼容。经过优化的特征随后被输入检测Head，实现跨多尺度的鲁棒目标检测。这种即插即用设计通过利用PST的交叉注意力能力，无缝增强了FPN框架。<br>PST-CLS结构如图3b所示，采用PST融合P4层和P5层的High-Level特征，作为Backbone网络后置的插件。通过PST模块整合这些语义丰富的特征，该架构捕获了全面的上下文信息，并将其传递给分类头。这种直接的集成在不需对现有Backbone网络进行大量修改的情况下提高了分类精度，展示了PST作为特征融合增强器的多功能性和有效性。<br>为评估所提出的PST在特征融合方面的有效性，作者在目标检测和图像分类任务上进行了实验。实验配置如下所述。所有模型均在NVIDIARTX4090GPU上进行训练和测试。<br>检测任务：作者在MSCOCO2017数据集上验证了PST。检测实验分为两部分。第一部分使用ResNet-18、ResNet-50和ResNet-101作为Backbone网络，集成了PST-DET结构，并将其性能与其他具有相同Backbone网络的基于注意力机制的特征金字塔网络（FPN）方法进行了比较。第二部分专注于实时检测，采用YOLOv11变体（Nano、Small、Medium），将Head替换为PST架构，并与最先进的实时检测框架进行了基准测试。所有模型均使用SGD优化器进行训练，初始学习率为0. 01，与YOLOv11保持一致。<br>分类任务：在分类任务中，作者使用ResNet-18、ResNet50和ResNet-101作为Backbone网络评估PST-CLS架构。作者还探索了YOLOv11-cls变体（Nano和Small）的轻量级配置，将P4和P5层特征融合结构替换为PST-CLS。使用SGD优化器，动量为0. 9，学习率为0. 1，批处理大小为256，在ImageNet数据集上进行200个epoch的训练。性能指标使用top-1和top-5准确率进行评估。<br>对于基于ResNet的检测器，如表1所示，PST-DET在低FLOPs和高FLOPs尺度上始终优于基于注意力的FPN方法。使用ResNet-18+PST-N，实现了46. 3%的mAP，尽管Backbone网络较轻，但仍超越了R-50-AFPN（38. 4%）和R-50-A2-FPN-Lite（39. 8%），AP75达到49. 6%（对比41. 9%和43. 4%）。在更高的FLOPs下，ResNet-101+PST·S实现了50. 9%的mAP，显著超过R-101-AFPN（40. 2%）和R-101-A2FPN（42. 8%），AP50达到68. 1%。这些结果表明PST具有更优越的多尺度特征融合能力，突显了其相对于仅使用更重Backbone网络的有效性。图1a提供了更直观的视觉对比。<br>为了实时检测，作者在COCO2017验证集上对比了PST增强的YOLOv11模型与Baseline模型以及其他最先进的检测器，如表2所示。YOLOv11-PST实现了40. 3%的mAP，优于YOLOv11-N（39. 4%），其使用FlashAttention的延迟为1. 24ms。YOLOv11-PST-S和YOLOv11-PST-M分别达到了47. 4%和52. 1%的mAP，超越了YOLOv11-S（46. 9%）和YOLOv11-M（51. 5%），且具有相当或更低的FLOPs。这些改进验证了PST在实时环境下提升准确性和效率的能力。图1b提供了更直观的视觉对比。<br>作者还使用ImageNet验证了PST作为分类插件（PST-CLS）的效果，采用ResNet-18&#x2F;50&#x2F;101和轻量级YOLOv11-clsBackbone网络（表3）。在所有架构中，集成PST均能在相应Baseline模型上带来稳定的精度提升——例如，ResNet-18精度提升约6%，ResNet-50和ResNet-101提升1-2%，YOLOv11-cls变体在top-1精度上提升约1%。这些结果表明，PST能够以极小的开销增强重载和轻量级Backbone网络，在无需专门Backbone网络设计的情况下，实现了精度与效率的良好权衡。<br>为评估PST中关键组件的贡献，作者在COCO2017数据集上开展消融实验，聚焦于使用YOLOv11-PST-N模型进行的检测任务。实验评估了top-k选择、PSA堆叠设计、自门控机制、线性注意力变体、参数共享以及注意力核类型的影响。结果汇总于表4，其中加粗条目表示性能最优的配置。<br>Top-选择：一个有趣的现象是，将top-替换为Gumbel-Softmax软top-[33]并在训练期间启用精细注意力导致了显著的训练困难，并且精度下降超过5%。因此，表4a展示了仅在推理阶段启用精细注意力的结果，它表明top-值为8实现了最高的为40. 3%，延迟为1. 24ms。将top-增加到16和32分别将降低到39. 5%和38. 9%，同时显著增加延迟到1. 50ms和1.94ms。这表明选择适中的top-token数量（例如8）优化了准确性和效率，而较大的值则引入了计算开销而没有性能提升。<br>PSA堆叠设计：PSA堆叠结构的工作方式是，PSA模块的Query从前一个PSA层接收输入，而Key和Value在所有PSA模块中保持一致。最后，所有PSA模块的输出被连接起来以进行后续处理。表4b显示，单个PSA阶段获得了最佳的为，并具有最低的延迟。堆叠额外的阶段（2、4、6）将降低到和，同时显著增加了延迟至、和。这表明单个PSA阶段足以实现有效的特征融合，而额外的阶段引入冗余和计算负担，却未提升准确性。<br>自门控机制：受NSA[ 49]的启发，自门控机制设计了一种使用门控张量融合粗粒度和细粒度注意力输出的方法。给定形状相同的粗粒度输出和细粒度输出，作者将它们连接起来，并应用一个一维卷积，然后是一个sigmoid层。<br>因此，最终输出为：<br>表4c表明禁用自门控机制可以提高Nano（N）和Small（S）模型的，分别达到40. 3%和47. 4%，而启用门控机制时分别为40. 0%和46. 2%。这表明自门控机制可能引入不必要的复杂性，略微降低性能。<br>线性注意力变体：为了探索更轻量级的模型，作者研究了用线性注意力[ 21]替换标准的多头注意力机制（MHA）（注意该操作使得精细的注意力计算变得不可行）。作者比较了原始线性注意力、将激活函数替换为ReLU的线性注意力以及将top-设置为0的标准MHA。表4d显示，标准线性注意力变体实现了最佳的为，而Linear-ReLU变体降至，Linear-EL变体未能收敛（NaN）。这突出了标准注意力机制在PST中的稳定性和有效性。<br>参数共享：在PSA的设计中，粗粒度注意力和细粒度注意力共享同一组卷积来计算Key和Value。在此，作者将此与它们分别计算的情况进行比较。表表明，粗粒度和细粒度注意力阶段之间的参数共享不会影响（共享和不共享设置均为-40. 3%）或延迟（1. 24ms）。然而，参数共享减少了模型的参数数量和训练复杂度，使其成为在不牺牲性能的情况下的一种有利的设<br>注意力核：表4f比较了不同的注意力核，SageAttention（SA）在Nano模型上实现了最低的延迟1. 21毫秒，在Small模型上实现了2. 33毫秒，优于NaivePyTorch（1. 94毫秒和4.62毫秒·）和FlashAttention（FA）（1. 24毫秒和2.50毫秒）。这突显了SageAttention在减少计算开销的同时保持精度的效率。<br>作者介绍了金字塔SparseTransformer（PST），这是一种通过交叉注意力引导机制和动态token选择来增强多尺度特征融合的新型架构。PST利用从粗到细的注意力策略和参数共享，高效地整合多尺度特征，优化了计算效率和性能。<br>通过用交叉注意力替代传统自注意力机制，并结合卷积，PST有效地捕获了跨特征层级的层次依赖关系。当与各种Backbone网络集成并应用于目标检测（PST-DET）和图像分类（PST-CLS）框架时，PST始终优于Baseline方法，在COCO和ImageNet数据集上实现了准确性的显著提升。这些结果验证了PST在提供鲁棒特征融合方面的能力，使其成为适用于广泛视觉任务的通用且高效的解决方案。<br>[1].PyramidSparseTransformer:EfficientMulti-ScaleFeatureFusionwithDynamicTokenSelection<br>欢迎加入《AI未来星球》，一起成长<br>扫描下方二维码即可加入~<br>真诚分享AI落地过程（AI商机-&gt;项目签约-&gt;算法开发-&gt;产品开发-&gt;实施运维）中的各方面经验和踩过的坑。<br>你可以获得什么？<br>1、大白之前花费10W+购买，AI行业各场景私有数据集下载，星球内倾情分享；2、AI行业研发、产品、商业落地问题咨询（目前AI公司创业中），都可获高质量解答，有效期一年，无限次提问，有问必答。3、定期邀请AI行业各类嘉宾分享，创业&#x2F;商业等方面的经验！<br>帮助你解决遇到的实际问题，升职加薪！<br>大家一起加油！</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">ZejunCao</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://zejuncao.github.io/2025/06/10/1000001642-2247540110-1/">https://zejuncao.github.io/2025/06/10/1000001642-2247540110-1/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">ZejunCao</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%B1%9F%E5%A4%A7%E7%99%BD/">
                                    <span class="chip bg-color">江大白</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2025/06/10/2247521855-2247521855-1/">
                    <div class="card-image">
                        
                        <img src="/medias/frontcover/2247521855_2247521855_1.jpg" class="responsive-img" alt="突发！特朗普派700名海军陆战队，逮捕加州州长">
                        
                        <span class="card-title">突发！特朗普派700名海军陆战队，逮捕加州州长</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-06-10
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            ZejunCao
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/AIGC%E5%BC%80%E6%94%BE%E7%A4%BE%E5%8C%BA/">
                        <span class="chip bg-color">AIGC开放社区</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/06/10/1000001642-2247540110-2/">
                    <div class="card-image">
                        
                        <img src="/medias/frontcover/1000001642_2247540110_2.jpg" class="responsive-img" alt="Pytorch框架，怎么使用C++调用部署模型？">
                        
                        <span class="card-title">Pytorch框架，怎么使用C++调用部署模型？</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-06-10
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            ZejunCao
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%B1%9F%E5%A4%A7%E7%99%BD/">
                        <span class="chip bg-color">江大白</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2025</span>
            
            <a href="/about" target="_blank">ZejunCao</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/ZejunCao" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:caozejun369@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1378463428" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1378463428" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/5915009280" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/5915009280" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/Garfusion/posts" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/Garfusion/posts" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
