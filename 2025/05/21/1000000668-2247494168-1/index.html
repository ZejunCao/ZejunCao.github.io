<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="RAG 挑战赛冠军方案解析：从数据解析到多路由器检索的工程实践，推荐阅读！, ZejunCao&#39;Blogs">
    <meta name="description" content="RAG 挑战赛冠军方案解析：从数据解析到多路由器检索的工程实践，推荐阅读！

仅用于站内搜索，没有排版格式，具体信息请跳转上方微信公众号内链接

多路由器+动态知识库：RAG冠军方案的核心技术揭秘源码地址：https :&amp;#x2F;&amp;#x2">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>RAG 挑战赛冠军方案解析：从数据解析到多路由器检索的工程实践，推荐阅读！ | ZejunCao&#39;Blogs</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ZejunCao&#39;Blogs</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ZejunCao&#39;Blogs</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/frontcover/1000000668_2247494168_1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">RAG 挑战赛冠军方案解析：从数据解析到多路由器检索的工程实践，推荐阅读！</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/ChallengeHub/">
                                <span class="chip bg-color">ChallengeHub</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-05-21
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/VPidqY02ngsrnXhpOol3_A">RAG 挑战赛冠军方案解析：从数据解析到多路由器检索的工程实践，推荐阅读！</a></p>
<blockquote>
<p>仅用于站内搜索，没有排版格式，具体信息请跳转上方微信公众号内链接</p>
</blockquote>
<p>多路由器+动态知识库：RAG冠军方案的核心技术揭秘<br>源码地址：https :&#x2F;&#x2F;github. com&#x2F;IlyaRice&#x2F;RAG-Challenge-2&#x2F;tree&#x2F;main<br>比赛的任务是基于公司年度报告构建一个问答系统。简单来说，比赛当天的流程如下：<br>我们会收到来自随机挑选公司的100份年度报告，并需要在2. 5小时内解析这些报告并构建一个数据库。这些报告是PDF格式，每份最长可达1000页。<br>然后，系统会生成100个随机问题（基于预设模板），我们的系统必须尽可能快速地回答这些问题。<br>所有问题都必须有确定的答案，例如：<br>是&#x2F;否；<br>公司名称（某些情况下是多个公司名称）；<br>领导职位头衔、推出的产品名称；<br>数值指标：营收、商店数量等。<br>每个答案都必须注明引用的页码作为证据，确保系统是真正从原文中得出答案，而不是输出虚假信息（hallucinate）。<br>获胜方案在基础步骤之外，还加入了两个路由器（router）和LLM重排序模块（LLMreranking）。</p>
<p>接下来，我们将深入探讨构建该系统的每一个步骤，我们在过程中遇到的波折与困难，以及在此过程中摸索出的最佳实践。<br>RAG（Retrieval-AugmentedGeneration，检索增强生成）是一种通过与任意大小的知识库结合，从而扩展大语言模型（LLM）能力的方法。<br>解析(Parsing)：为知识库准备数据，包括收集文档、将其转换为文本格式，并清理无关的噪点信息。<br>数据摄取(Ingestion)：创建并载入知识库。<br>检索(Retrieval)：构建一个工具，根据用户查询查找并返回相关数据，通常在向量数据库中进行语义搜索。<br>回答(Answering)：使用检索到的数据丰富用户的提示词（prompt），将其发送给LLM，并返回最终答案。<br>要开始填充任何数据库，首先必须将PDF文档转换为纯文本。PDF解析是一项远非易事的工作，其中充满了无数细微的难题：<br>保留表格结构；<br>保留关键的格式元素（例如标题和项目符号列表）；<br>识别多栏文本；<br>处理图表、图片、公式、页眉&#x2F;页脚等等。<br>遇到但没时间解决的有趣的PDF解析问题：<br>大型表格有时会旋转90度，导致解析器产生乱码或无法阅读的文本。<br>*图表部分由图片、部分由文本层组成。<br>有些文档存在字体编码问题：视觉上看文本是没问题的，但尝试复制或解析时会得到一堆乱七八糟的字符。<br>有意思的是：我们单独调查了这个问题，发现文本是可以解码的——它是一个凯撒密码（Caesarcipher），每个单词的ASCII位移量都不同。这让我们产生了许多疑問。如果有人故意加密了一份公开可查的公司报告以阻止复制——为什么？如果是在转换过程中字体出了问题——为什么偏偏是这种方式？<br>我们尝试了大约二十几种PDF解析器：<br>小众解析器；<br>知名的解析器；<br>基于前沿机器学习算法训练的解析器；<br>支持API访问的商业解析器。<br>我们可以肯定地说，目前没有任何解析器可以处理所有细微之处，并在不丢失部分重要信息的情况下，将PDF内容完全还原为文本。<br>在RAG挑战赛中表现最好的解析器是相对知名的Docling。有趣的是，它的开发方是比赛的协办方之一——IBM。<br>尽管Docling的结果非常优秀，但它缺乏一些基本能力。这些功能部分存在，但分散在不同的配置中，无法组合在一起。<br>因此，我们卷起袖子，彻底研究了库的源代码，并重写了几个方法以满足我们的需求，从而在解析后得到了一个包含所有必要元数据的JSON文件。利用这个JSON，我们构建了一个Markdown文档，其格式经过修正，并且表格结构从PDF转换为Markdown甚至HTML（这在后来证明非常有用！）的还原度接近完美。<br>这个库相当快，但仍然不够快到能在2. 5小时内在个人笔记本电脑上解析1.5万页文档。为了解决这个问题，我们利用了GPU加速解析，并在比赛期间租用了一台配备4090GPU的虚拟机，每小时花费70美分。<br>解析所有100份文档耗时约40分钟，根据其他参赛者的报告和评论，这是极高的解析速度。<br>至此，我们的报告已被解析为JSON格式。<br>现在我们可以填充数据库了吗？<br>还没。首先，我们必须清除文本中的噪点信息，并对表格进行预处理。<br>有时部分文本从PDF中解析出来时会出错，包含特定的语法，降低了可读性和意义。我们使用了一批十几个正则表达式来处理这个问题。<br>解析不佳的文本示例<br>之前提到的凯撒密码文档也通过正则表达式模式检测到了。我们试图解码它们，但即使修复后，它们仍然包含许多伪影（artifact）。因此，我们干脆直接对这些文档进行了完整的OCR识别。<br>在大型表格中，度量名称（横向表头）通常离纵向表头太远，削弱了语义连贯性。<br>有1500个不相关的token将纵向和横向表头隔开<br>这显著降低了在向量搜索中chunk的相关性（更不用说表格完全装不进一个chunk的情况了）。此外，LLM在处理大型表格时也很难将度量名称与表头对应起来，可能会返回错误的值。</p>
<p>序列化的核心是将一个大表格转化为一系列小的、上下文独立的字符串。<br>在经过大量的提示词（prompts）和结构化输出schema实验后，我们发现了一种解决方案，即使是GPT-4o-mini也能几乎无损地序列化大型表格。最初，我们以Markdown格式向LLM输入表格，但后来改用HTML格式（这就是它派上用场的地方！）。语言模型对HTML的理解程度要高得多，而且HTML可以描述包含合并单元格、子标题和其他复杂结构的表格。<br>要回答诸如“这家公司2021年的股东权益是多少？”之类的问题，只需向LLM输入一个句子，而非一个包含许多“噪点”的大型结构，这就足够了。<br>在序列化过程中，整个表格被转换成这样一组独立的块：<br>subject_core_entity：<em>Shareholders’equity（股东权益）</em><br>information_block：<em>截至2012&#x2F;3至2022&#x2F;3年的股东权益如下：637,422百万日元（2012&#x2F;3），535,422百万日元（2013&#x2F;3），679,160百万日元（2014&#x2F;3），782,556百万日元（2015&#x2F;3），540,951百万日元（2016&#x2F;3），571,983百万日元（2017&#x2F;3），511,242百万日元（2018&#x2F;3），525,064百万日元（2019&#x2F;3），513,335百万日元（2020&#x2F;3），577,782百万日元（2021&#x2F;3），以及1,274,570百万日元（2022&#x2F;3）。</em><br>获得表格的序列化版本后，我们将其放在原表格下方，作为每一个元素的文本标注。<br>我们可以在项目的仓库中查看序列化的提示词和逻辑：tables_serialization. py<br>*尽管序列化潜力巨大，但获胜的解决方案最终并未采用它。我们将在文章末尾解释原因。<br>报告已从PDF转换为干净的Markdown文本。现在让我们用它们来创建数据库。<br>在搜索系统領域（如GoogleSearch、全文搜索、ElasticSearch、向量搜索等），一个文档(document)是系统返回的单一索引元素作为查询结果。一个文档可以是一个句子、段落、页面、网站、图片——不重要。但就个人而言，这个定义总是让我们困惑，因为它有一个更常用、更日常的含义：文档(document)作为一份报告、合同或证书。<br>因此，从现在起，我们将使用文档在其日常含义上。<br>存储在数据库中的元素，我们称之为<strong>块(chunk)<strong>，因为我们存储的只是被切分过的文本片段。<br>根据比赛规则，我们必须指明包含相关信息的页码。企业系统也采用同样的方法：引用允许验证模型的答案是否是虚假信息（hallucinated）。<br>这不仅使系统对用户更透明，也简化了开发过程中的调试。<br>最简单的选择是将文档的整页作为一个块，因为页面很少超过几千个token。<br>但让我们再次思考查询和文档文本块之间的语义连贯性。通常情况下，足以回答问题的信息片段不超过十个句子。<br>因此，从逻辑上讲，一个包含目标语句的小段落将比同样语句稀释在一整页相关性较弱的文本中获得更高的相似度得分。<br>我们将每页的文本分割成300个token（约15个句子）的块。<br>为了切分文本，我们使用了带有自定义Markdown词典的递归拆分器。为了避免信息在两个块之间被切断而丢失，我们添加了一个小的文本重叠（50个token）。如果我们担心重叠不能完全消除切分不当带来的风险，可以搜索一下“语义拆分器(Semanticsplitter)”。如果我们计划只将找到的块插入到上下文中，这一点尤其重要。<br>然而，切分的精确度对我们的检索系统几乎没有影响。<br>每个块都存储其ID及其在元数据（metadata）中的父页面编号。<br>我们的块集合已准备就绪；现在让我们创建向量数据库——或者更确切地说，是多个数据库。100个数据库，其中1个数据库&#x3D;1个文档。<br>因为为什么要将所有公司的信息混合在一起，之后再试图将一个公司的收入与另一个公司分开呢？答案的目标信息总是严格限制在单个文档内。<br>我们只需根据给定的问题确定要查询哪个数据库（稍后会详细介绍）。<br>为了创建、存储和搜索向量数据库，我们使用了FAISS。<br>数据库使用IndexFlatIP方法创建。<br>Flat索引的优点是所有向量都“原样”存储，没有压缩或量化。搜索使用暴力搜索，精度更高。缺点是这种搜索计算和内存消耗显著更高。<br>如果我们的数据库至少有十万个元素，可以考虑IVFFlat或HNSW。这些格式速度快得多（尽管创建数据库时需要稍多一些资源）。但速度的提升是以牺牲精度为代价的，因为它使用的是近似最近邻搜索（ANN）。<br>将所有文档的块分离到不同的索引中，我们得以使用Flat数据库。<br>IP（内积）用于通过余弦相似度计算相关性得分。除了IP，还有L2——它通过欧氏距离计算相关性得分。IP通常能提供更好的相关性评分。<br>为了将块和查询嵌入到向量表示中，我们使用了text-embedding-3-large。<br>创建好数据库后，是时候进入RAG系统的“R”（检索）部分了。<br>检索器（Retriever）是一个通用的搜索系统，它接收查询作为输入，并返回包含回答所需信息的相关文本。<br>在基础实现中，它只是对向量数据库发起查询，提取TopN个结果。<br>这是RAG系统中尤其关键的部分：如果LLM在查询上下文中没有接收到必要信息，它就无法提供正确答案——无论我们如何精心微调解析或回答提示词。<br>\“垃圾进→垃圾出（Junkin→Junkout）。\“<br>提高检索器质量的方法有很多。以下是我们在比赛期间探索过的方法：<br>vDB+BM25混合搜索（Hybridsearch）结合了基于向量的语义搜索和传统的基于关键词的文本搜索（BM25算法）。理论上，它通过不仅考虑文本含义，还考虑精确关键词匹配来提高检索准确性。通常，两种方法的搜索结果会合并并根据综合得分进行重排序。<br>我们并不是特别喜欢这种方法：在它的基础实现中，它通常会降低检索质量而不是提高。<br>总的来说，混合搜索是一個不错的技巧，通过修改输入查询可以進一步优化。最简单地说，LLM可以重述问题以去除噪点并增加关键词密度。<br>如果我们在混合搜索方面有积极的经验，特别是关于潜在问题和解决方案，请在评论区分享。<br>无论如何，我们心中有更具前景的替代方案，于是決定不再进一步探索这个方向。<br>使用交叉编码器模型（Cross-encodermodels）对向量搜索结果进行重排序看起来很有前景。简单来说，交叉编码器能给出更精确的相似度分數，但速度较慢。<br>交叉编码器介于嵌入模型（例如双编码器bi-encoder）和LLM之间。与通过文本的向量表示（这inherently会丢失一些信息）进行比较不同，交叉编码器直接评估两个文本之间的语义相似度，从而给出更准确的分数。<br>然而，对查询与数据库中每个元素的成对比较耗时太长。<br>因此，交叉编码器重排序仅适用于向量编码器过滤出一小部分块。<br>在比赛的最后一刻，我们放弃了这种方法，原因是通过API提供的交叉编码器重排序模型稀缺。无论是OpenAI还是其他大型提供商都没有提供，而我们不想为了管理另一个API余额而麻烦。<br>但如果我们有兴趣尝试交叉编码器重排序，我们推荐JinaReranker。它在基准测试中表现出色，而且注册后Jina会提供慷慨的免费请求额度。<br>最终，我们选择了更具吸引力的替代方案：LLM重排序！<br>这很简单：将文本和问题传递给LLM，并问：“这段文本有助于回答问题吗？有多大帮助？它的相关性评分从0到1是多少？”<br>直到最近，由于强大的LLM模型成本高昂，这种方法还不可行。但现在我们有了快速、廉价且足够智能的LLM模型。<br>和交叉编码器重排序一样，我们也在通过向量搜索初步过滤后应用此方法。<br>我们开发了一个详细的提示词，描述了通用指导和精确到0. 1的显式相关性标准：<br>0&#x3D;完全不相关：文本块与查询没有任何联系或关联。<br>0. 1&#x3D;基本不相关：仅与查询有非常轻微或模糊的关联。<br>0. 2&#x3D;非常微弱相关：包含极其微小或切线式的关联。<br>…<br>LLM查询被格式化为结构化输出（Structuredoutput），包含两个字段：reasoning（让模型解释其判断）和relevance_score，可以直接从JSON中提取，无需额外解析。<br>我们进一步优化了流程，在一个请求中同时发送三页内容，提示LLM同时返回三个页面的分数。这提高了速度，降低了成本，并因相邻文本块能为模型的评估提供更多上下文而略微提高了评分的一致性。<br>修正后的相关性得分使用加权平均计算：<br>vector_weight&#x3D;0. 3，llm_weight&#x3D;0. 7理论上，我们可以直接跳过向量搜索，将每一页都直接传递给LLM。有些参赛者就这样做了，而且取得了成功。然而，我们相信使用嵌入（embedding）进行更便宜、更快速的过滤仍然是必要的。对于一份1000页的文档（有些文档就是这么大），仅仅回答一个问题就可能花费约25美分——太昂贵了。<br>而且，归根结底，我们是在参加一场RAG挑战赛，不是吗？<br>通过GPT-4o-mini进行重排序的成本对我们来说每个问题不到一美分！这种方法在质量、速度和成本之间取得了出色的平衡——这正是我们选择它的原因。<br>我们可以在这里查看重排序提示词：prompts. py<br>还记得我们之前提到将文本分割成更小的块吗？好吧，这里有一个小但重要的注意事项。<br>是的，回答问题的核心信息通常集中在一个小的块中——这正是将文本分解成小块能提高检索质量的原因。<br>但该页上剩余的文本可能仍然包含次要的——但仍然重要——的细节。<br>因此，在找到TopN个相关块后，我们只将它们用作指向整个页面的指针；然后将完整的页面添加到上下文（context）中。这正是我们在每个块的元数据中记录页面编号的原因。<br>让我们回顾一下最终检索器的步骤：<br>对查询进行向量化。<br>根据查询向量找到Top30个相关块。3. 通过块的元数据提取对应的页面（记得去重！）。<br>通过LLM重排序器处理这些页面。<br>调整页面的相关性得分。<br>返回得分最高的Top10页，在每一页前面加上页码，并将它们合并成一个字符串。<br>我们的检索器现在准备就绪了！<br>我们的向量数据库已建立，检索器已准备好。RAG系统中的“R”（检索）部分至此已完成，我们现在进入“A”（增强）部分，这部分相当直接，主要包括f-string和字符串拼接操作。<br>一个有趣的地方是我们组织提示词存储的方式。在多个项目中尝试了不同的方法后，我们最终确定了以下方法：<br>我们将提示词存储在一个专门的prompts. py文件中，通常将提示词分割成逻辑块：<br>核心系统指令；<br>定义LLM返回响应格式的Pydanticschema；<br>用于创建单次示例（one-shot）&#x2F;少次示例（few-shot）提示词的问答对示例；<br>用于插入上下文和查询的模板。<br>一个小型函数会根据需要将这些块组合成最终的提示词配置。这种方法允许灵活测试不同的提示词配置（例如，比较不同示例对单次示例提示词的有效性）。<br>某些指令可能会在多个提示词中重复出现。以前，修改这类指令意味着需要在所有使用它们的提示词中同步更新，这很容易导致错误。模块化方法解决了这个问题。现在，我们将重复出现的指令放入一个共享块中，并在多个提示词中重用。此外，当提示词变得过长时，模块化块也简化了处理。<br>所有提示词都可以在项目仓库中查看：prompts. py<br>RAG中的第三个部分“G”（生成）是最耗费精力的。要在这一阶段实现高质量，需要巧妙地应用几种基本技术。<br>这是RAG系统中最简单却最有用的部分之一。<br>回想一下，每份报告都有其独立的向量数据库。问题生成器设计成公司名称始终明确出现在问题中。<br>我们也有所有公司名称的列表（比赛开始时与PDF报告一同提供）。因此，从查询中提取公司名称甚至不需要LLM：我们只需遍历列表，通过re. search()从问题中提取名称，并将其与相应的数据库匹配。<br>在实际应用场景中，将查询路由到数据库比在我们受控、理想的环境中更复杂。我们很可能还会需要额外的预处理任务：为数据库打标签，或者使用LLM从问题中提取实体，然后将其与数据库匹配。但在概念上，方法保持不变。<br>总结一下：<br>找到公司名称→匹配到相应的向量数据库→只在该数据库中搜索。搜索空间缩小了100倍。<br>比赛的一个要求是回答的格式。每个答案必须简洁，并严格符合数据类型，就像直接将其存入公司数据库一样。<br>每个问题旁边都明確給出了预期的数据类型——int&#x2F;float、bool、str或list[ str]。<br>每种类型都涉及3到6个需要在回答时考虑的细微之处。<br>例如，如果问题询问某个指标的数值，答案必须是纯数字，不包含评论、货币符号等。对于金钱指标，报告中的货币必须与问题中提到的货币一致，并且数字必须规范化——例如报告中常写“$1352(inthousands)”，系统必须回覆“1352000”。<br>如何确保LLM同时考虑所有这些细微之处而不出错？简单地说：我们做不到。给LLM的规则越多，它忽视它们的可能性就越高。即使只有八条规则，对当前的LLM来说也多得危险。模型的认知能力是有限的，额外的规则会分散其回答核心问题的注意力。<br>这逻辑上得出了一个结论：我们应该尽量减少每个查询的规则数量。一个方法是将一个查询分解为一系列更简单的查詢。<br>然而，在我们的案例中，由于明确提供了预期的响应类型，我们可以实现一个更简单的解决方案——根据不同的答案类型，我们們只向提示詞提供相应的指令集。<br>我们编写了四种提示词变体，並使用简单的ifelse语句选择正确的那个。<br>比赛还包括比较多家公司指标的问题。这类问题与那些更简单的查询不符，因为它们需要额外的步骤来回答。<br>问题示例：<br>苹果和微软谁的营收更高？<br>我们想想：人会如何處理这个任务？<br>首先，他们會分别查找每家公司的营收，然后进行比较。<br>我们将同样的思维嵌入到我们的系统中。<br>我们将最初的比较问题传递给LLM，并要求它创建更简单的子问题，以分别提取每家公司的指标。<br>在我们的例子中，更简单的子问题将是：<br>苹果的营收是多少？和微软的营收是多少？<br>现在我们可以通过标准流程分别处理每家公司的这些更简单的查询。收集到每家公司的答案后，我们将它们作为上下文传递给LLM，以回答最初的问题。<br>这种模式适用于任何复杂的查询。关键在于识别它们并确定所需的子步骤。<br>思维链（CoT）通过让模型在给出最终答案之前“出声思考”，显著提高了答案质量。LLM不会立即给出答案，而是生成一系列导致解决方案的中间推理步骤。<br>就像人类一样，LLM在将复杂問題分解為更小、更簡單的問題時，處理得更好。CoT幫助模型避免遗漏关键细节，有条不紊地處理信息，并得出正确结论。在上下文包含可能误导模型的“陷阱”时，它尤其有用。<br>我们无疑听说过那句标志性的话：一步步思考(Thinkstepbystep)。这是最早试图通过提示词（prompting）来提高答案质量的尝试之一。它实际上催生了奇特的“提示词工程（promptengineering）”。然而，对于严肃的任务，这种通用指令是不够的。<br>LLM有时会“虚假推理（fakereasoning）”——例如，先给出即时答案，然后倒过来找理由解释，或者编造不存在的事实。这个问题在像GPT-4o-mini或Llama8b这样较弱的模型中尤为常见。<br>为了确保CoT有益，我们必须清晰地引导模型如何进行推理。解釋推理步驟、目標，并提供示例。<br>根据提示词指令明确地构建推理步骤，可以显著增强规则的遵循。<br>在RAG中，当报告中缺乏完全符合要求的指标时，上下文可能包含相似但不完全相同的信息。模型可能會試圖扭曲提供的数据以符合请求的指标。由于模型被训练得乐于助人，它们偏向于提供某个答案而不是承认不知道。<br>仅仅要求模型保持怀疑态度来对抗这种偏见确实有效——但并非始终如一，也并非在所有情况下都有效。相反，明确提示模型从不同角度或视角分析信息会更有帮助。<br>我们特別指示模型重点评估问题和上下文之间指标的兼容性。这显著减少了虚假信息的生成。<br>问题：<br>RitterPharmaceuticalsInc. 的研发设备（按成本计）是多少？<br>模型的推理步骤：<br>问题询问RitterPharmaceuticalsInc. 的“研发设备，按成本计”。这表明需要从资产负债表中提取一个特定数值，代表专门用于研发的设备的原始购置成本，不包含任何累计折旧。<br>上下文（第35页）显示“不动产和设备，净额”为12,500美元。这是一个净值（已扣除折旧），而且是一个更广泛的类别，包含所有不动产和设备，而不仅仅是研发设备。<br>上下文（第37页）还提到“机械和设备”的“累计折旧”为110,000美元。这代表了总的折旧，而不是原始成本，更重要的是，它没有说明这些设备专门用于研发。<br>这两个指标都不完全符合请求的指标。“不动产和设备，净额”范围太广，且是折旧后的价值。“累计折旧”仅显示折旧，而非成本，并且缺乏研发的针对性。5. 由于上下文没有提供仅用于研发设备的原始成本，且我们無法進行假設、計算或組合信息，因此答案是“N&#x2F;A”。<br>结构化输出（StructuredOutput，SO）是一种强制模型以严格定义的格式响应的方式。它通常作为一个单独的参数传递给API，例如一个Pydantic或JSONschema（模式）。<br>这保证了模型总是返回符合所提供schema的有效JSON数据。<br>字段描述也可以包含在响应schema中。这些不影响结构，但会被LLM视为提示词的一部分来处理。<br>例如，以下是用于LLM重排序的Pydanticschema：<br>有了这个schema，LLM总是会返回一个包含两个字段的JSON——第一个是字符串，第二个是数字。<br>上述方法可以理想地结合使用。<br>在生成阶段，模型有一个专门用于推理的字段，还有一个单独的字段用于最终答案。这使得我们可以直接提取答案，而无需从冗长的推理步骤中进行解析。<br>可以在结构化输出中以多种方式实现思维链。例如，您可以使用多个JSON字段，每个字段引导模型得出中间结论，这些结论的组合最终引导它得出正确的最终答案。<br>然而，由于回答比赛问题所需的逻辑无法通过预定义的一组分步指令来描述，我们采用了更通用的方法，为模型提供一个单一的推理字段，并直接在提示词中定义推理序列。<br>在我们用于回答比赛问题的主要schema中，只有四个字段：<br>step_by_step_analysis——初步推理（思维链本身）。<br>reasoning_summary——前一个字段的精简摘要（用于更轻松地跟踪模型的逻辑）。<br>relevant_pages——答案引用的报告页码。<br>final_answer——根据比赛要求格式化后的简洁答案。<br>前三个字段在为不同答案类型量身定制的四种提示词中被重用。第四个字段每次都有所不同，指定答案类型并描述模型必須Consideration的具體細微之處。<br>例如，确保final_answer字段始终是数字或“N&#x2F;A”是这样实现的：<br>final_answer:Union[float,int,Literal[‘N&#x2F;A’]]<br>并非所有LLM都支持结构化输出，因为只有它才能保证完全遵守schema。<br>如果一个模型没有专门的结构化输出功能，我们仍然可以直接在提示词中呈现输出schema。在大多数情况下，模型通常足够智能，可以返回有效的JSON。然而，部分答案不可避免地会偏离schema，导致代码出错。小型模型尤其如此，大约一半的时间都无法符合要求。<br>为了解决这个问题，我们编写了一个回退方法，它使用schema. model_validate(answer)来验证模型的响应是否符合schema。如果验证失败，该方法会将响应重新发送给LLM，提示它遵守schema。<br>这种方法将schema合规率提高到100%，即使对于8b模型也是如此。<br>这是提示词本身。<br>这是另一种常见且相当显而易见的方法：在提示词中添加一个问答示例对，可以提高响应质量和一致性。<br>我们在每个提示词中都添加了一对“问题→答案”，答案以结构化输出定义的JSON格式编写。<br>这个示例同时服务于多种目的：<br>展示一个示例性的分步推理过程。<br>进一步阐明在困难情况下的正确行为（帮助重新校准模型的偏见）。<br>演示模型回答应该遵循的JSON结构（尤其对缺乏原生SO支持的模型有用）。<br>我们非常重视精心编写这些示例答案。提示词中示例的质量可以提升或降低响应质量，因此每个示例必须与指令完全一致，并且总体上几乎无懈可击。如果示例答案与指令矛盾，模型就会变得困惑，这会对其表现产生负面影响。<br>我们仔细地修改了示例中的分步推理字段，手动调整了推理结构和每个短语的措辞。<br>这一部分的工作量与整个数据准备阶段不相上下，因为需要进行无止境的迭代调试、校对答案以及手动分析模型的推理过程。<br>在编写提示词之前，我们徹底研究了响应要求和问题生成器。<br>构建一个以LLM为核心的优秀系统的关键在于理解客户需求。通常，这需要深入的专业领域知識和对问题的细致检查。我们坚信，除非我们清晰地理解问题本身以及如何找到答案，否则不可能为企业构建真正高质量的问答系统（如果有人能说服我们，我们会很高兴）。<br>这种理解也是澄清用户问题中所有隐含意义所必需的。<br>让我们考虑问题示例：</strong>ACMEinc的CEO是谁？</strong><br>在一个理想的世界里，报告总是会明确地提供答案，不留误解的余地：<br>现由JohnDoe负责CEO职责<br>RAG系统会在报告中找到这句话，将其添加到查询上下文，用户会收到一个明确的答案：JohnDoe<br>然而，我们生活在现实世界中，成千上万的公司以各种方式表达信息，伴随着无数额外的细微之处。<br>这就引出了一个问题：到底什么可以归入“CEO”这个称谓之下？<br>系统应该多么字面地理解客户的问题？<br>客户是想知道担任类似管理角色的人的名字，还是严格来说就是那个特定的职位头衔？<br>稍微偏离字面解释是否可以接受？偏离多远算太远？<br>潜在地，以下职位可能被包括在内：<br>首席执行官(ChiefExecutiveOfficer)——显然就是CEO的全称。</p>
<p>我们不确定是否存在对此已有的术语，但我们个人将其称为“解释自由度阈值”问题。<br>当响应是自由格式时，解释自由度阈值相对容易解决。在模棱两可的情况下，LLM会尝试涵盖用户查询中所有隐含的含义，并添加一些澄清。<br>这是一个真实示例的ChatGPT回复：<br>根据提供的上下文，EthanCaldwell是董事总经理，这是该公司中最接近CEO的职位。但是，由于正在进行的监管调查，他已被正式暂停了积极的行政职责。虽然他保留了头衔，但目前不参与公司运营，领导权已暂时移交给董事会监督下的高级管理团队。<br>然而，如果系统架构要求简洁的答案，就像RAG挑战赛这样，模型在这些情况下表现就不稳定了，依赖其内部的“直觉”。<br>因此，解释自由度阈值必须提前定义和校准。但由于无法明确定义和量化这个阈值，必须识别所有主要的边缘情况，制定通用的查询解释规则，并与客户澄清模糊之处。<br>除了理解问题外，还可能出现一些普遍的困境。<br>例如：ACMEinc是否宣布了股息政策的任何变更？<br>系统是否应该将报告中缺乏信息解读为没有宣布任何变更？<br>Rinat（比赛组织者）可以证实——在比赛准备期间，我们用几十个类似的问题和困境轰炸了他:)<br>比赛开始前一周，问题生成器的代码公开了。मैंतुरंत生成了一百个问题，并从中创建了一个验证集。<br>手动回答问题相当繁琐，但这在两个关键领域帮助了我们：<br>当我们进行改进时，验证集可以客观地衡量系统的质量。通过在该集合上运行系统，我们可以监控它正确回答了多少问题以及最常在哪里出错。这种反馈循环有助于迭代改进提示词和其他流水线组件。<br>手动分析问题突出了问题和报告中不明显的细节和歧义。这让我们能与Rinat核实回答要求，并将这些规则明确地反映在提示词中。<br>我们将所有这些澄清纳入提示词中作为指令集。<br>答案类型&#x3D;数字<br>如果提供的指标与问题中提到的货币不同，则返回“N&#x2F;A”。如果上下文没有直接说明指标（即使可以从上下文中的其他指标計算得出），则返回“N&#x2F;A”。特别注意上下文是否提到指标是以单位、千或百万为单位报告的，以便在最終答案中相应地调整数字，不作任何更改、添加三个零或六个零。注意值是否用括号括起来；这意味着该值为负数。<br>答案类型&#x3D;名称<br>如果问题询问职位（例如职位的变动），则仅返回职位头衔，不包括姓名或任何其他信息。任命新的领导职位也應算作职位的变动。如果提到与同一头衔的职位相关的几次变动，只返回该职位头衔一次。职位头衔始终应使用单数形式。<br>如果问题询问新推出的产品，则仅返回上下文中的产品名称，完全按照原文。新产品候选者或测试阶段的产品不应计为新推出的产品。<br>模型很容易遵循某些指令，由于固有的偏见而抗拒其他指令，并且在某些指令上遇到了困难，导致错误。例如，模型在跟踪计量单位（千、百万）时反复出错，忘记在最终答案中添加必要的零。于是，我们在指令中补充了一个简短的示例：<br>千为单位的数字示例：<br>上下文中的值：4970,5(inthousands$)<br>最终答案：4970500<br>最终，我们为每种问题格式编写了提示词，并编写了几个辅助提示词：<br>数字类型问题最终提示词<br>名称类型问题最终提示词<br>名称列表类型问题最终提示词<br>布尔类型问题最终提示词<br>比较类型问题最终提示词（用于通过多查询路由比较多个公司的答案）<br>比较类型问题的复述提示词（用于初步在报告中查找指标）<br>LLM重排序提示词<br>SO重解析器提示词对指令的细致优化结合单次示例和结构化输出思维链，带来了显著的好处。最终的提示词彻底改变了系统中不必要的偏见，并极大地提高了对细微之处的关注度，即使对于较弱的模型也是如此。<br>最初，RAG挑战赛的规则更严格，要求系统在10分钟内回答所有100个问题，才有资格获得奖金。我们认真对待这项要求，并力求充分利用OpenAI的每分钟token限制。<br>即使在Tier2，限额也很慷慨——GPT-4o-mini每分钟2百万token，GPT-4o每分钟45万token。我们估算了每个问题的token消耗量，并分批处理25个问题。系统仅用了2分钟就完成了所有100个问题。<br>最后，提交解决方案的时间被大大延长了——其他参赛者根本无法及时完成:)<br>拥有一个验证集不仅帮助改进了提示词，也使整个系统受益。<br>我们将所有关键功能配置化，以便衡量它们的实际效果并微调超参数。以下是一些示例配置字段：<br>在测试不同配置时，我们惊讶地发现我们对它寄予厚望的表格序列化功能不仅没有改进系统，反而略微降低了其有效性。显然，Docling从PDF解析表格的能力足够好，检索器也能有效地找到它们，而LLM在没有额外帮助的情况下也能充分理解它们的结构。而向页面添加更多文本只会降低信噪比。<br>我们还为比赛准备了多种配置，以便在所有类别中快速运行各种系统。<br>最终系统在使用开源模型和商业模型时都表现出色：Llama3. 370b的得分仅比OpenAI的o3-mini低几个点。even微小的Llama8b在总榜上都超过了80%的参赛者。<br>最终，赢得RAG挑战赛并非因为找到了某个神奇的解决方案，而是因为采取了系统化的方法，深思熟虑地结合和微调了各种技术，并深入钻研了任务细节。关键的成功因素包括高质量的解析、高效的检索、智能的路由，以及——最值得一提的——LLM重排序和精心设计的提示词，这些使得即使使用紧凑的模型也能取得出色的结果。<br>这场比赛的主要启示很简单：RAG的魔力在于细节。我们越了解任务，就能越精确地微调每个流水线组件，从最简单的技术中也能获得更大的收益。<br>作者已将所有系统代码开源。其中包括如何自行部署系统和运行流水线任意阶段的说明。<br>添加微信，备注”LLM“进入大模型技术交流群<br>如果你觉得这篇文章对你有帮助，别忘了点个赞、送个喜欢</p>
<blockquote>
<p>&#x2F;作者：致Great</p>
</blockquote>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">ZejunCao</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://zejuncao.github.io/2025/05/21/1000000668-2247494168-1/">https://zejuncao.github.io/2025/05/21/1000000668-2247494168-1/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">ZejunCao</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/ChallengeHub/">
                                    <span class="chip bg-color">ChallengeHub</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2025/05/21/1000002118-2247588058-2/">
                    <div class="card-image">
                        
                        <img src="/medias/frontcover/1000002118_2247588058_2.jpg" class="responsive-img" alt="腾讯算法三面终极拷问：为什么 GRPO 容易出现 reward 崩塌？">
                        
                        <span class="card-title">腾讯算法三面终极拷问：为什么 GRPO 容易出现 reward 崩塌？</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-05-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            ZejunCao
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E9%82%A3%E4%BA%9B%E4%BA%8B/">
                        <span class="chip bg-color">机器学习算法那些事</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/05/21/1000001692-2247513853-1/">
                    <div class="card-image">
                        
                        <img src="/medias/frontcover/1000001692_2247513853_1.jpg" class="responsive-img" alt="2025年国产大模型清单！">
                        
                        <span class="card-title">2025年国产大模型清单！</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-05-21
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            ZejunCao
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/kaggle%E7%AB%9E%E8%B5%9B%E5%AE%9D%E5%85%B8/">
                        <span class="chip bg-color">kaggle竞赛宝典</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2025</span>
            
            <a href="/about" target="_blank">ZejunCao</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/ZejunCao" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:caozejun369@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1378463428" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1378463428" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/5915009280" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/5915009280" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/Garfusion/posts" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/Garfusion/posts" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
